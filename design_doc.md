## デザインドキュメント: s3c (s3-client)

### 1. 概要

`s3c`は、S3互換オブジェクトストレージをローカル環境から操作するためのGUIクライアントツールである。Go言語で実装されたシングルバイナリとして配布され、実行するとローカルでWebサーバーが起動し、Webブラウザ経由で操作を行う。マルチプラットフォームでの動作をサポートする。

### 2. 機能要件

#### 2.1. アプリケーション起動と設定

-   **起動**: シングルバイナリを実行すると、デフォルトで`localhost:8080`でWebサーバーを起動する。
    -   ポート番号は`-p`または`--port`フラグで変更可能。（例: `./s3c -p 3000`）
-   **初期画面**: アプリケーション起動後、初めてブラウザでアクセスすると設定画面 (`/settings`) にリダイレクトされる。
-   **設定項目**:
    -   **プロファイル**: `~/.aws/credentials`からプロファイル名を読み込み、ドロップダウンで選択する。認証情報はAWS SDKが自動で読み込む（`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_SESSION_TOKEN`）。
    -   **エンドポイントURL**: S3互換ストレージのエンドポイントURL。空白の場合はAWSのデフォルトエンドポイントを使用する。
    -   **リージョン**: 操作対象のリージョン。手入力とし、ブラウザの入力補完を有効にする。
-   **設定の永続化**: 設定情報はアプリケーション実行中のメモリ上でのみ保持する。アプリケーションを再起動した場合は、再度設定画面から入力する。

#### 2.2. GUI構成

-   **レイアウト**: 画面は左側のナビゲーションバーと右側のメイン操作領域で構成される。
-   **ナビゲーションバー**:
    -   左上にアプリケーション名「s3c」、接続中のエンドポイント、AWSアカウントID（取得可能な場合）を表示する。
    -   右上に「ホーム」「設定」「終了」のアイコンを配置する。
-   **終了機能**: 「終了」アイコンをクリックすると、確認ダイアログが表示される。同意すると、Web UIを閉じるだけでなく、Goアプリケーション本体も終了する。

#### 2.3. S3オブジェクト操作

-   **基本レイアウト**:
    -   **操作行 (Action Row)**: 画面上部に配置。「戻る（一つ上の階層へ）」アイコン（左寄せ）、「アップロード」「ダウンロード」「削除」ボタン（右寄せ）を配置する。
    -   **表示行 (Display Row)**: 残りの領域全体。バケットまたはオブジェクトの一覧を表示する。
-   **一覧表示**:
    -   **表示項目**: 「ファイル/フォルダ名」「最終更新日時（実行環境のタイムゾーン）」「サイズ」。
    -   **空の場合**: バケットがなければ「バケットがありません」、オブジェクトがなければ「オブジェクトがありません」と表示する。
    -   **ページネーション**: 1ページあたり100件を表示し、それ以上はページングを行う。URLクエリでページを指定する（例: `/buckets/foo-bucket?page=2`）。
-   **ナビゲーション**:
    -   バケットをクリックすると、そのバケット内のオブジェクト一覧に遷移する (例: `/buckets/foo-bucket`)。
    -   フォルダをクリックすると、そのフォルダ内のオブジェクト一覧に遷移する (例: `/buckets/foo-bucket/bar/`)。
-   **選択と操作**:
    -   各行の左側にチェックボックスを配置する。
    -   **複数選択**: ファイルは複数選択可能。
    -   **単一選択**: フォルダは1つのみ選択可能。ファイルとフォルダの同時選択は不可。
    -   選択状態によって操作ボタンの活性/非活性を制御する（例: ファイル選択中はアップロードボタンを非活性化）。

#### 2.4. 主要機能詳細

-   **アップロード**:
    -   操作行の「アップロード」ボタンをクリックすると、アップロード専用画面 (`/upload`) に遷移する。
    -   ドラッグ&ドロップまたはファイル選択ダイアログで、複数ファイルを同時にアップロードできる。
    -   アップロード処理中はモーダルで進捗をパーセント表示し、UIをブロッキングする。
    -   完了後、「アップロード完了」ダイアログを表示する。
-   **ダウンロード**:
    -   **ファイル**: 選択したファイルをダウンロードする。
    -   **フォルダ**: 選択したフォルダ内の全オブジェクトを再帰的に取得し、ルートフォルダ名を冠したZIPファイルとして圧縮してダウンロードする。
    -   ダウンロード処理中はモーダルで進捗をパーセント表示し、UIをブロッキングする。
-   **削除**:
    -   **ファイル**: 選択したファイルを削除する。
    -   **フォルダ**: 選択したフォルダ内の全オブジェクトを再帰的に削除する。
    -   削除処理中はモーダルでUIをブロッキングする。
-   **プレビュー**:
    -   ファイル名をクリックするとモーダルウィンドウでプレビューを表示する。
    -   **対応形式**:
        -   テキスト (`.txt`, `.md`, `.json`, `.yaml`, `.yml`): 最大100KBまでをプレーンテキストで表示。XSS対策を施す。
        -   画像 (`.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.webp`): 最大5MBまでを表示。超える場合はエラーメッセージを表示。
    -   対応外のファイルや処理エラーの場合は、プレビュー不可の旨を表示する。

#### 2.5. エラーハンドリング

-   S3操作などでエラーが発生した場合、画面上部にトースト形式でエラーメッセージを表示する。
-   メッセージには、ユーザーフレンドリーな概要と、AWS SDKから返却された詳細なエラー情報の両方を含める。

### 3. 技術要件

-   **バックエンド**:
    -   **言語**: Go 1.24
    -   **CLI**: `urfave/cli/v2`
    -   **Webフレームワーク**: 標準パッケージ (`net/http`)
    -   **AWS連携**: AWS SDK for Go v2。PathStyleアクセスは使用しない（テストを除く）。
    -   **設計**: SOLID原則、Testability、Twelve-Factor Appを意識した標準的な構成。
-   **フロントエンド**:
    -   **フレームワーク**: React.js, Vue.jsなど任意。ただしビルド後の静的ファイルをGoバイナリに`embed`できること。
    -   **スタイリング**: Tailwind CSS (ライトテーマ)
    -   **バンドルツール**: Vite
-   **テスト**:
    -   **Go**: 標準の`testing`パッケージを使用。S3統合テストでは`testcontainers-go`と`localstack`を使用する。ユニットテストのカバレッジを重視する。
    -   **フロントエンド**: ロジック部分のユニットテストを記述する。
-   **ビルド・CI/CD**:
    -   **タスクランナー**: `Makefile`
    -   **CI/CD**: GitHub Actions
    -   **リリース**: GoReleaser を用いてマルチプラットフォーム向けのバイナリをビルドし、リリースを作成する。


